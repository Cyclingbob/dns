function getRequestServerName(){var serverName=decodeURIComponent((RegExp('redirect_uri='+'(.+?)(&|$)').exec(location.search)||[,''])[1]);serverName=serverName.replace(/^(https?|ftp):\/\//,'');serverName=serverName.replace(/:[\d]+/,'');serverName=serverName.replace(/[\/]+.*/,'');if(!serverName||serverName===''){serverName='Unknown';}
return serverName;}
function formToJSON(formData){var array=$(formData).serializeArray();var json={};$.each(array,function(){json[this.name]=this.value||'';});return JSON.stringify(json);}
function processLogin(){$.ajax({type:'POST',url:'/oauth2/auth/login',data:formToJSON($('#login-form')),dataType:'json',contentType:'application/json; charset=utf-8',success:function(response){response.status==200?window.location.replace(response.data.redirect_uri):'';},error:function(xhr,ajaxOptions,thrownError){var data=xhr.responseJSON;if(data.data.tos_agreement_needed){$('.error-description').text('Please agree to the terms of service').show();$('#legal-info').show();}else{$('.error-description').text('Username or Password Incorrect').show();}
$('form#login-form .form-group').each(function(){$(this).addClass('has-error');});},});}
$(document).on('ready',function(){var requesting_uri=getRequestServerName()||'';$('#requesting-uri').text(requesting_uri);$('#page-container').fadeIn();$('form#login-form .form-group').each(function(){$(this).keyup(function(){$('form#login-form .form-group').each(function(){$(this).removeClass('has-error');});});});$('form#login-form').bind('submit',function(e){e.preventDefault();processLogin();return true;});var passwordRequest;$('form#reset-password-form').submit(function(e){e.preventDefault();if(passwordRequest){passwordRequest.abort();}
var $form=$(this);var $inputs=$form.find('input');var serializedData=$form.serialize();$inputs.prop('disabled',true);passwordRequest=$.ajax({url:'/review/resetpass.cgi?json=1',type:'POST',data:serializedData,});passwordRequest.done(function(response,textStatus,jqXHR){if(response.status==200){$('#reset-password-group').fadeOut('fast',function(){$('#password-was-reset-group').fadeIn();$('#reset-password-group').remove();});}});passwordRequest.fail(function(jqXHR,textStatus,errorThrown){console.error('The following error occurred: '+textStatus,errorThrown);});passwordRequest.always(function(){$inputs.prop('disabled',false);});});var createAccountRequest;var signInControl=$('#sign-in-control');$('a[data-toggle="tab"]').on('show.bs.tab',function(e){if($(e.target).attr('href')==='#create-account'){signInControl.show();}else{signInControl.hide();}});$('form#create-account-form').submit(function(e){e.preventDefault();$('#create-account-error .error-description').text('');$('#create-account-error').fadeOut();if(!$('#checkbox-legal-agreement').is(':checked')){$('#create-account-error .error-description').text('You must agree to the cPanel Terms of Use');$('#create-account-error').fadeIn();return;}
if(createAccountRequest){createAccountRequest.abort();}
var $form=$(this);var $inputs=$form.find('input');var serializedData=$form.serialize();$inputs.prop('disabled',true);createAccountRequest=$.ajax({url:'/review/create_user.cgi',type:'POST',data:serializedData,});createAccountRequest.done(function(response,textStatus,jqXHR){if(jqXHR.status==200){$('#account-was-created-text').text(response.message);$('#create-account-group').fadeOut('fast',function(){$('#account-was-created-group').fadeIn();$('#create-account-group').remove();});setTimeout(function(){location.reload();},2000);}});createAccountRequest.fail(function(jqXHR,textStatus,errorThrown){var data=JSON.parse(jqXHR.responseText);$('#create-account-error .error-description').text(data.message);$('#create-account-error').slideDown();console.error('The following error occurred: '+textStatus,errorThrown);});createAccountRequest.always(function(){$inputs.prop('disabled',false);});});$('#checkbox-tos-agree').on('change',function(event){if($(this).is(':checked')){processLogin();}});});
